const childProcess = require('child_process');

function runTask(callback) {
  // verificar que el callback no se ejecute mas de una vez
  let invoked = false;
  const process = childProcess.fork('./src/config/server');

  // escucha el evento error para poder prevenir que el proceso se cierre
  process.on('error', (err) => {
    console.log(err);
    if (invoked) return;
    invoked = true;
    console.log('Error process');
    callback(err);
  });

  // ejecuta el callback una vez el proceso se haya cerrado
  process.on('exit', (code) => {
    if (invoked) return;
    invoked = true;
    const err = code === 0 ? null : new Error(`exit code ${code}`);
    console.log('Exit process');
    callback(err);
  });
}

runTask((err) => {
  if (err) throw err;
  console.log('El servidor est√° corriendo');
});
